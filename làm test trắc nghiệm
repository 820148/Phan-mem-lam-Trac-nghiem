<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ph·∫ßn m·ªÅm thi tr·∫Øc nghi·ªám</title>

<style>
html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
    background: #f8f9fa;
}

/* ===== TRANG NH·∫¨P ===== */
#setup {
    padding: 12px;
    max-width: 600px;
    margin: auto;
}

textarea {
    width: 100%;
    height: 200px;
    font-size: 15px;
    line-height: 1.4;
}

/* ===== TRANG THI ===== */
#examPage { height: 100%; }

/* ===== THANH TR√äN ===== */
.top-bar {
    max-width: 600px;
    margin: auto;
    padding: 8px 12px;
    background: #f8f9fa;
    position: sticky;
    top: 0;
    z-index: 100;
}

/* ===== TI√äU ƒê·ªÄ ===== */
.exam-title {
    text-align: center;
    margin: 6px 0;
}

/* ===== ƒê·ªíNG H·ªí ===== */
.timer {
    margin: 6px auto;
    width: fit-content;
    background: #ffeeba;
    padding: 6px 12px;
    font-size: 24px;
    font-weight: bold;
    color: #d00000;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

/* ===== N√öT TR√äN ===== */
.top-buttons {
    text-align: center;
}

.top-buttons button {
    margin: 4px;
}

/* ===== KHUNG C√ÇU H·ªéI ===== */
#examContainer {
    height: calc(100vh - 220px);
    overflow-y: auto;
    padding: 12px;
    max-width: 600px;
    margin: auto;
}

/* ===== C√ÇU H·ªéI ===== */
.question {
    margin-bottom: 18px;
    padding: 10px;
    border-radius: 6px;
    background: #ffffff;
    line-height: 1.45;
    font-size: 16px;
}

.question b {
    display: block;
    margin-bottom: 8px;
}

label {
    display: block;
    margin-bottom: 6px;
    font-size: 15px;
}

/* ===== ƒê√ÅNH D·∫§U ===== */
.unanswered { border: 3px solid red; }
.correct { background-color: #d4edda; }
.wrong { background-color: #f8d7da; }

.selected-correct { color: #0a8a2a; font-weight: bold; }
.selected-wrong { color: #c00000; font-weight: bold; }

.correct-answer {
    color: green;
    font-weight: bold;
    margin-top: 6px;
}

/* ===== K·∫æT QU·∫¢ ===== */
.score-box {
    margin-top: 20px;
    padding: 18px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    text-align: center;
}

.score-box h2 {
    margin: 0;
    font-size: 28px;
}

.score-box .percent {
    font-size: 44px;
    font-weight: bold;
    color: #d00000;
    margin: 10px 0;
}

/* ===== N√öT ===== */
button {
    padding: 10px 18px;
    font-size: 15px;
    border-radius: 6px;
}

.hidden { display: none; }
</style>
</head>

<body>

<!-- ===== TRANG NH·∫¨P ===== -->
<div id="setup">
<h2>PH·∫¶N M·ªÄM THI TR·∫ÆC NGHI·ªÜM</h2>

<textarea id="inputText" placeholder="D√°n c√¢u h·ªèi t·∫°i ƒë√¢y"></textarea>

<br><br>
<label>‚è± Th·ªùi gian l√†m b√†i (ph√∫t): </label>
<input type="number" id="timeLimit" value="10" min="1">

<br><br>
<button onclick="startExam()">T·∫°o ƒë·ªÅ thi</button>
</div>

<!-- ===== TRANG THI ===== -->
<div id="examPage" class="hidden">

<div class="top-bar">
    <h2 class="exam-title">ƒê·ªÄ THI TR·∫ÆC NGHI·ªÜM</h2>
    <div class="timer" id="timer"></div>

    <div class="top-buttons">
        <button onclick="checkProgress()">Ki·ªÉm tra b√†i l√†m</button>
        <button onclick="submitExam()">N·ªôp b√†i</button>
    </div>
</div>

<div id="examContainer">
    <div id="exam"></div>
    <div id="result"></div>
</div>
</div>

<script>
let answers = {};
let correct = {};
let optionsStore = {};
let timeLeft;
let timerInterval;
let submitted = false;

function startExam() {
    document.getElementById("setup").classList.add("hidden");
    document.getElementById("examPage").classList.remove("hidden");

    answers = {};
    correct = {};
    optionsStore = {};
    submitted = false;
    document.getElementById("exam").innerHTML = "";
    document.getElementById("result").innerHTML = "";

    let text = document.getElementById("inputText").value.trim();
    let minutes = parseInt(document.getElementById("timeLimit").value);
    timeLeft = minutes * 60;

    let blocks = text.split(/\n\s*\n/);

    blocks.forEach((block, index) => {
        let lines = block.split("\n").map(l => l.trim()).filter(Boolean);
        let questionLines = [];
        let options = {};
        let answer = "";

        lines.forEach(line => {
            if (/^[ABCD]\./.test(line)) options[line[0]] = line;
            else if (line.startsWith("ƒê√°p √°n")) answer = line.split(":")[1].trim();
            else questionLines.push(line);
        });

        if (!answer || Object.keys(options).length < 4) return;

        correct[index] = answer;
        optionsStore[index] = options;

        let html = `<div class="question" id="q${index}">
            <b>${questionLines.join("<br>")}</b>`;

        ["A","B","C","D"].forEach(k => {
            html += `<label>
                <input type="radio" name="q${index}" value="${k}"
                onchange="answers[${index}]='${k}'">
                ${options[k]}
            </label>`;
        });

        html += `</div>`;
        document.getElementById("exam").innerHTML += html;
    });

    startTimer();
}

function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        let m = Math.floor(timeLeft / 60);
        let s = timeLeft % 60;
        document.getElementById("timer").innerText =
            `${m}:${s < 10 ? "0" : ""}${s}`;
        if (timeLeft <= 0) submitExam();
        timeLeft--;
    }, 1000);
}

function checkProgress() {
    let total = Object.keys(correct).length;
    let done = 0;
    for (let i in correct) {
        let q = document.getElementById("q"+i);
        q.classList.remove("unanswered");
        if (!answers[i]) q.classList.add("unanswered");
        else done++;
    }
    alert(`ƒê√£ l√†m: ${done}/${total}`);
}

function submitExam() {
    if (submitted) return;
    submitted = true;
    clearInterval(timerInterval);

    let total = Object.keys(correct).length;
    let score = 0;

    for (let i in correct) {
        let q = document.getElementById("q"+i);
        let radios = q.querySelectorAll("input");

        radios.forEach(r => {
            r.disabled = true;
            if (r.checked) {
                r.parentElement.classList.add(
                    r.value === correct[i] ? "selected-correct" : "selected-wrong"
                );
            }
        });

        if (answers[i] === correct[i]) {
            score++;
            q.classList.add("correct");
        } else {
            q.classList.add("wrong");
            q.innerHTML += `<div class="correct-answer">‚úî ƒê√°p √°n ƒë√∫ng: ${optionsStore[i][correct[i]]}</div>`;
        }
    }

    let percent = ((score/total)*100).toFixed(1);
    document.getElementById("result").innerHTML = `
        <div class="score-box">
            <h2>K·∫æT QU·∫¢ B√ÄI THI</h2>
            <div class="percent">${percent}%</div>
            <div>S·ªë c√¢u ƒë√∫ng: <b>${score}/${total}</b></div>
            <br>
            <button onclick="location.reload()">üîÅ Quay l·∫°i t·∫°o ƒë·ªÅ</button>
        </div>
    `;
}
</script>

</body>
</html>